@inherits DNNrocketAPI.render.DNNrocketTokens<Simplisity.SimplisityRazor>
@using DNNrocketAPI;
@using Simplisity;
@using Rocket.AppThemes.Componants;
@using System.IO;

@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/images/App_LocalResources/")
@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/api/App_LocalResources/")
@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/SystemData/App_LocalResources/")
@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/AppThemes/App_LocalResources/")

@{
    var appTheme = (AppTheme)Model.List.First();
    var info = appTheme.Info;
}
@{
    var dataDic = new Dictionary<string, string>();
    foreach (string i in appTheme.VersionList)
    {
        dataDic.Add(i, i);
    }

    var flagurl = "/DesktopModules/DNNrocket/API/images/flags/16/" + DNNrocketUtils.GetEditCulture() + ".png";
    if (!File.Exists(DNNrocketUtils.MapPath(flagurl)))
    {
        flagurl = "/DesktopModules/DNNrocket/API/images/flags/16/none.png";
    }
    var flagurl32 = "/DesktopModules/DNNrocket/API/images/flags/32/" + DNNrocketUtils.GetEditCulture() + ".png";
    if (!File.Exists(DNNrocketUtils.MapPath(flagurl32)))
    {
        flagurl32 = "/DesktopModules/DNNrocket/API/images/flags/32/none.png";
    }

    var disabled = "";

    var imgLP = 1;
    var imgdatalist = info.GetList("imagelist");

    var templateLP = 1;
    var templatedatalist = info.GetList("templatelist");
    var cssLP = 1;
    var cssdatalist = info.GetList("csslist");
    var jsLP = 1;
    var jsdatalist = info.GetList("jslist");

    var savelists = ".imagelist,.templatelist,.csslist,.jslist";
}


<div class="w3-row w3-padding">
    <div class="w3-col m2 w3-button w3-green w3-padding-8 langchangesave simplisity_click " s-track="false" s-cmd="rocketapptheme_save" s-post="#appthemedetails" s-list="@(savelists)" s-fields='{"appthemefolder":"@appTheme.AppThemeFolder"}'>@ResourceKey("DNNrocket.cmdSaveButton")</div>
    @ButtonGap()
    <div class="w3-col m2 w3-button w3-red w3-padding-8 simplisity_confirmclick" s-track="false" s-confirm="@ResourceKey("DNNrocket.delete")&nbsp;AppTheme?" s-cmd="rocketapptheme_delete" s-fields='{"appthemefolder":"@appTheme.AppThemeFolder"}'>@ResourceKey("DNNrocket.cmdDeleteButton") AppTheme</div>
    @ButtonGap()
    <div class="w3-col m2 w3-button w3-red w3-padding-8 simplisity_confirmclick" s-track="false" s-confirm="@ResourceKey("DNNrocket.delete")&nbsp;@ResourceKey("AppThemes.version")?" s-cmd="rocketapptheme_deleteversion" s-fields='{"appthemefolder":"@appTheme.AppThemeFolder"}'>@ResourceKey("DNNrocket.cmdDeleteButton")&nbsp;@ResourceKey("AppThemes.version")</div>
    @ButtonGap()
    <div class="w3-col m2 w3-button w3-khaki simplisity_click" s-cmd="rocketapptheme_getlist" s-track="true">@ResourceKey("DNNrocket.cmdReturnButton")</div>
</div>

<div class="w3-container">

    <h2>@appTheme.AppThemeFolder</h2>

    <div id="appthemedetails">

        <div class="w3-container w3-padding">
            <div class="w3-col m4 w3-padding">
                <label>@ResourceKey("AppThemes.name")</label>
                @TextBox(info, "genxml/textbox/appname", "class='w3-input w3-border' " + disabled)
            </div>
            <div class="w3-col m6 w3-padding">
                <label>@ResourceKey("AppThemes.displayname")</label>&nbsp;<img class='' src='@flagurl' alt='' />
                @TextBox(info, "genxml/lang/genxml/textbox/displayname", "class='w3-input w3-border'", "", true)
            </div>
            <div class="w3-col m2 w3-padding">
                <label>@ResourceKey("AppThemes.version")</label>
                @DropDownList(info, "genxml/select/versionfolder", dataDic, " class='w3-input w3-border' onchange=\"$('.simplisity_langchange').trigger('click')\" ")
            </div>
            <div class="w3-col m12 w3-padding">
                <label>@ResourceKey("AppThemes.summary")</label>&nbsp;<img class='' src='@flagurl' alt='' />
                @TextArea(info, "genxml/lang/genxml/textbox/summary", "class='w3-input w3-border'", "", true)
            </div>
        </div>
    </div>



    <div class="w3-container w3-theme w3-padding">
        <label>@ResourceKey("DNNrocket.images")</label>
    </div>

    <div class="w3-row imagelistdatasection">

        <div class="w3-container">
            <div class="w3-col w3-padding" style="width:160px;">
                <div class="w3-button w3-teal w3-padding-8 simplisity_click" s-track="false" s-cmd="rocketapptheme_addimage" s-post="#appthemedetails" s-list="@(savelists)" s-fields='{"appthemefolder":"@appTheme.AppThemeFolder"}'><i class='fas fa-plus-circle'></i></div>
                <div class="w3-button w3-pale-yellow w3-padding-8 simplisity_itemundo" s-recylebin="imagelistbin" s-return="#imagelistdata" s-removelist=".imagelist" style="display: none;"><i title="Add New" class="fas fa-undo fa-fw fa-lg"></i></div>
            </div>
        </div>

        <ul id="imagelistdata" class="w3-ul">

            @foreach (var imgInfo in imgdatalist)
            {
                <li class="imagelist w3-half w3-display-container w3-padding w3-border-0">
                    @SortableListIndex(imgLP)
                    <div class="w3-display-container  w3-card">
                        @ImageEditFullName(imgInfo, "imagepath", 150, 150, "", false, @imgLP)
                        <div class="w3-display-topright simplisity_removelistitem" s-removelist=".imagelist" s-recylebin="imagelistbin" style="cursor: pointer;">
                            <i title="@ResourceKey("DNNrocket.delete")" class="fas fa-minus-square fa-fw fa-lg"></i>
                        </div>
                    </div>
                </li>

                imgLP += 1;
            }
        </ul>

    </div>


    <div class="w3-container w3-theme w3-padding">
        <label>@ResourceKey("AppThemes.templates")</label>
    </div>

    <div class="w3-row templatelistdatasection">

        <div class="w3-container">
            <div class="w3-col w3-padding" style="width:160px;">
                <div class="w3-button w3-teal w3-padding-8 simplisity_click" s-track="false" s-cmd="rocketapptheme_addtemplate" s-post="#appthemedetails" s-list="@(savelists)" s-fields='{"appthemefolder":"@appTheme.AppThemeFolder"}'><i class='fas fa-plus-circle'></i></div>
                <div class="w3-button w3-pale-yellow w3-padding-8 simplisity_itemundo" s-recylebin="templatelistbin" s-return="#templatelistdata" s-removelist=".templatelist" style="display: none;"><i title="Add New" class="fas fa-undo fa-fw fa-lg"></i></div>
            </div>
        </div>

        <ul id="templatelistdata" class="w3-ul">

            @foreach (var templateInfo in templatedatalist)
            {
                <li class="templatelist w3-col m4 w3-display-container w3-padding w3-border-0">
                    @SortableListIndex(templateLP)
                    @HiddenField(templateInfo, "genxml/hidden/editorcodehtmlmixed", "", "", false, templateLP)
                    @HiddenField(templateInfo, "genxml/hidden/filefolder", "", "default", false, templateLP)
                    <div class="w3-row w3-display-container w3-padding  w3-card">

                        <div class="">
                            @{
                                var disabledfilename = "";
                                var hideicon = "display:none;";
                            }
                            @if (templateInfo.GetXmlProperty("genxml/hidden/filename") != "")
                            {
                                disabledfilename = "disabled";
                                hideicon = "";
                            }

                            <div class="w3-col m8">
                                <div>
                                    @TextBox(templateInfo, "genxml/hidden/filename", " " + disabledfilename + " class='w3-input w3-border filenametext' index='" + templateLP + "' autocomplete='false' placeholder='" + ResourceKey("AppThemes.filename") + "...' ", "", false, templateLP)
                                </div>
                            </div>
                            <div class="w3-col w3-margin-left" style="width:62px;">
                                <div class="w3-button filenameicon@(templateLP)" onclick="edittemplate(@(templateLP));" style="@(hideicon)">
                                    <i class="fas fa-edit " style='font-size:24px'></i>
                                </div>
                            </div>
                            <div class="w3-col w3-display-topright w3-padding simplisity_removelistitem" s-removelist=".templatelist" s-recylebin="templatelistbin" style="cursor: pointer;width:42px;">
                                <i title="@ResourceKey("DNNrocket.delete")" class="fas fa-minus-square fa-fw fa-lg"></i>
                            </div>
                        </div>

                    </div>

                </li>

                templateLP += 1;
            }
        </ul>
    </div>

    <div class="w3-container w3-theme w3-padding">
        <label>@ResourceKey("AppThemes.css")</label>
    </div>

    <div class="w3-row csslistdatasection">

        <div class="w3-container">
            <div class="w3-col w3-padding" style="width:160px;">
                <div class="w3-button w3-teal w3-padding-8 simplisity_click" s-track="false" s-cmd="rocketapptheme_addcss" s-post="#appthemedetails" s-list="@(savelists)" s-fields='{"appthemefolder":"@appTheme.AppThemeFolder"}'><i class='fas fa-plus-circle'></i></div>
                <div class="w3-button w3-pale-yellow w3-padding-8 simplisity_itemundo" s-recylebin="csslistbin" s-return="#csslistdata" s-removelist=".csslist" style="display: none;"><i title="Add New" class="fas fa-undo fa-fw fa-lg"></i></div>
            </div>
        </div>


        <ul id="csslistdata" class="w3-ul">

            @foreach (var cssInfo in cssdatalist)
            {
                <li class="csslist w3-col m4 w3-display-container w3-padding w3-border-0">
                    @SortableListIndex(cssLP)
                    @HiddenField(cssInfo, "genxml/hidden/editorcodecss", "", "", false, cssLP)
                    @HiddenField(cssInfo, "genxml/hidden/filefolder", "", "default", false, cssLP)
                    <div class="w3-row w3-display-container w3-padding  w3-card">

                        <div class="">
                            @{
                                var disabledfilename = "";
                                var hideicon = "display:none;";
                            }
                            @if (cssInfo.GetXmlProperty("genxml/hidden/filename") != "")
                            {
                                disabledfilename = "disabled";
                                hideicon = "";
                            }

                            <div class="w3-col m8">
                                <div>
                                    @TextBox(cssInfo, "genxml/hidden/filename", " " + disabledfilename + " class='w3-input w3-border filenametext' index='" + cssLP + "' autocomplete='false' placeholder='" + ResourceKey("AppThemes.filename") + "...' ", "", false, cssLP)
                                </div>
                            </div>
                            <div class="w3-col w3-margin-left" style="width:62px;">
                                <div class="w3-button filenameicon@(cssLP)" onclick="editcss(@(cssLP));" style="@(hideicon)">
                                    <i class="fas fa-edit " style='font-size:24px'></i>
                                </div>
                            </div>
                            <div class="w3-col w3-display-topright w3-padding simplisity_removelistitem" s-removelist=".csslist" s-recylebin="csslistbin" style="cursor: pointer;width:42px;">
                                <i title="@ResourceKey("DNNrocket.delete")" class="fas fa-minus-square fa-fw fa-lg"></i>
                            </div>
                        </div>

                    </div>

                </li>

                cssLP += 1;
            }
        </ul>


    </div>

    <div class="w3-container w3-theme w3-padding">
        <label>@ResourceKey("AppThemes.js")</label>
    </div>

    <div class="w3-row jslistdatasection">

        <div class="w3-container">
            <div class="w3-col w3-padding" style="width:160px;">
                <div class="w3-button w3-teal w3-padding-8 simplisity_click" s-track="false" s-cmd="rocketapptheme_addjs" s-post="#appthemedetails" s-list="@(savelists)" s-fields='{"appthemefolder":"@appTheme.AppThemeFolder"}'><i class='fas fa-plus-circle'></i></div>
                <div class="w3-button w3-pale-yellow w3-padding-8 simplisity_itemundo" s-recylebin="jslistbin" s-return="#jslistdata" s-removelist=".jslist" style="display: none;"><i title="Add New" class="fas fa-undo fa-fw fa-lg"></i></div>
            </div>
        </div>

        <ul id="jslistdata" class="w3-ul">

            @foreach (var jsInfo in jsdatalist)
            {
                <li class="jslist w3-col m4 w3-display-container w3-padding w3-border-0">
                    @SortableListIndex(jsLP)
                    @HiddenField(jsInfo, "genxml/hidden/editorcodejavascript", "", "", false, jsLP)
                    @HiddenField(jsInfo, "genxml/hidden/filefolder", "", "default", false, jsLP)
                    <div class="w3-row w3-display-container w3-padding  w3-card">

                        <div class="">
                            @{
                                var disabledfilename = "";
                                var hideicon = "display:none;";
                            }
                            @if (jsInfo.GetXmlProperty("genxml/hidden/filename") != "")
                            {
                                disabledfilename = "disabled";
                                hideicon = "";
                            }

                            <div class="w3-col m8">
                                <div>
                                    @TextBox(jsInfo, "genxml/hidden/filename", " " + disabledfilename + " class='w3-input w3-border filenametext' index='" + jsLP + "' autocomplete='false' placeholder='" + ResourceKey("AppThemes.filename") + "...' ", "", false, jsLP)
                                </div>
                            </div>
                            <div class="w3-col w3-margin-left" style="width:62px;">
                                <div class="w3-button filenameicon@(jsLP)" onclick="editjs(@(jsLP));" style="@(hideicon)">
                                    <i class="fas fa-edit " style='font-size:24px'></i>
                                </div>
                            </div>
                            <div class="w3-col w3-display-topright w3-padding simplisity_removelistitem" s-removelist=".jslist" s-recylebin="jslistbin" style="cursor: pointer;width:42px;">
                                <i title="@ResourceKey("DNNrocket.delete")" class="fas fa-minus-square fa-fw fa-lg"></i>
                            </div>
                        </div>

                    </div>

                </li>

                jsLP += 1;
            }
        </ul>
    </div>


    <!-- The Modal -->
    <div id="editorpopup" class="w3-modal">
        <div class="w3-modal-content w3-grey w3-animate-zoom" style="width: 90%;">
            <header class="w3-container w3-theme">
                <div class="w3-row w3-padding">
                    <div class="w3-col m2 w3-button w3-yellow w3-padding-8" onclick="savetemplate()">@ResourceKey("DNNrocket.cmdReturnButton")</div>
                    @ButtonGap()
                    <div class="w3-col m2 w3-button w3-khaki " onclick="document.getElementById('editorpopup').style.display='none'">@ResourceKey("DNNrocket.cmdCancelButton")</div>
                </div>

            </header>
            <div id="editorwrapper" class="w3-row " style=""></div>
        </div>
    </div>


    <div id="dnnrocket_imageselectwrapper">
        @RenderImageSelect(100, true, false, appTheme.ImageFolderRel)
    </div>

</div>


<style>
    .CodeMirror {
        border: 1px solid #eee;
        height: auto;
    }
</style>

<script>

    var myCodeMirror;

    $(document).ready(function () {

        $("#imagelistdata").sortable();
        $("#imagelistdata").disableSelection();

        $('.filenametext').unbind("keyup");
        $(".filenametext").keyup(function (event) {
            var idx = $(this).attr('index');
            if ($(this).val() == '') {
                $('.filenameicon' + idx).hide();
            }
            else {
                $('.filenameicon' + idx).show();
            }
        });

        if (typeof myCodeMirror !== 'undefined') {
            window.onresize = function (event) {
                myCodeMirror.setSize($('#editorwrapper').width(), $('#editorwrapper').height());
            };
        }

    });

    function edittemplate(idx) {
        editeditor(idx,'htmlmixed');
    }

    function savetemplate() {
        saveeditor('htmlmixed');
    }

    function editcss(idx) {
        editeditor(idx,'css');
    }

    function savecss() {
        saveeditor('css');
    }

    function editjs(idx) {
        editeditor(idx,'javascript');
    }

    function savejs() {
        saveeditor('javascript');
    }

    function editeditor(idx, modetype) {

        $('#editorpopup').show();

        $("#razoreditor").remove();
        $(".CodeMirror").remove();

        var newHeight = $(window).height() - 200;
        $('#editorwrapper').css("height", newHeight);;

        var textArea = $('<textarea id="razoreditor" class="w3-input w3-border" spellcheck="false" />');
        $('#editorwrapper').append(textArea);

        myCodeMirror = CodeMirror.fromTextArea(document.getElementById("razoreditor"), {
            lineNumbers: false,
            mode: modetype
        });
        var editorcode = $('#editorcode' + modetype + '_' + idx).val();
        myCodeMirror.setValue(simplisity_decode(editorcode));

        myCodeMirror.setSize($('#editorwrapper').width(), $('#editorwrapper').height());

        $('#editorwrapper').attr("index", idx);

        $('#razoreditor').focus();
    }

    function saveeditor(modetype) {
        var idx = $('#editorwrapper').attr("index");
        $('#editorpopup').hide();
        $('#editorcode' + modetype + '_' + idx).val(simplisity_encode(myCodeMirror.getValue()));
    }


    function languageChange() {
        $('.langchangesave').trigger("click");
    }

</script>