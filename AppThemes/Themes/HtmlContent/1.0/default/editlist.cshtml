@inherits RocketMod.RocketModTokens<Simplisity.SimplisityRazor>
@using DNNrocketAPI;
@using Simplisity;
@using RocketSettings;
@using RocketMod;

@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/api/App_LocalResources/")
@AddProcessData("resourcepath", "/DesktopModules/DNNrocketModules/RocketMod/App_LocalResources/")
@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/AppThemes/Themes/HtmlContent/1.0/resx/")
@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/Images/App_LocalResources/")

@{
    var articleDataList = (ArticleDataList)Model.List.First();
}


<span class="w3-section simplisity_buttons">
    <a class="w3-button w3-teal w3-padding-8 simplisity_click" s-cmd="edit_addarticle" s-fields='{"tabid":"@Model.GetSettingInt("tabid")","moduleid":"@Model.ModuleId",}'>@ResourceKey("DNNrocket.cmdAddButton")</a>
</span>

<div id="datasection">

    <ul id="datalist" class="w3-ul">

        @{
            var lp1 = 0;
        }
        @foreach (SimplisityInfo i in articleDataList.DataList)
        {
            lp1 += 1;
            <li class="settingsdata w3-card w3-margin w3-display-container">

                <!-- Required to sort items in list -->
                @SortableList(i, lp1)

                <div class="listrow">
                    <span id="deletebutton@(lp1)" onclick="" class="w3-button w3-display-topright simplisity_removelistitem" s-removelist=".settingsdata" s-recylebin="databin">
                        <i title="Remove" class="fas fa-minus-square fa-fw fa-lg"></i>
                    </span>
                    <span id="editbutton@(lp1)" row="@(lp1)" class="w3-button w3-display-topleft editbutton">
                        <i class="fas fa-edit"></i>
                    </span>
                    <span id="editbuttonclosedown@(lp1)" row="@(lp1)" class="w3-button w3-display-topleft editbuttonclose" style="display:none;">
                        <i class="fas fa-caret-down"></i>
                    </span>

                    <div class="w3-row">
                        <div class="w3-col " style="width: 50px;">
                            <span>&nbsp;</span>
                        </div>
                        <div class="w3-col " style="width: 100px;">
                            @if (i.GetXmlProperty("genxml/hidden/imagepath1") != "")
                            {
                                <img src="@ThumbnailImageUrl(i.GetXmlProperty("genxml/hidden/imagepath1"),75,75)" />
                            }
                            else
                            {
                                <span>&nbsp;</span>
                            }
                        </div>
                        <div class="w3-rest">
                            <div class="w3-col m10 w3-padding">
                                <label class="">@ResourceKey("HtmlContent.title")</label>&nbsp;@EditFlag()
                                @TextBox(i, "genxml/lang/genxml/textbox/header", " class='w3-input w3-border' autocomplete='off'", "", true, lp1)
                            </div>
                            <div class="w3-col m2  w3-padding">
                                <label class="">@ResourceKey("HtmlContent.style")</label>
                                @DropDownList(i, "genxml/select/headerstyle", "H1,H2,H3,H4", "H1,H2,H3,H4", " class='w3-input w3-border' style='width:100px;' ", "H1", false, lp1)
                            </div>
                        </div>
                        <div class="w3-col " style="width: 50px;">
                            <span>&nbsp;</span>
                        </div>
                    </div>
                </div>

            </li>

        }
    </ul>

</div>

@RenderDocumentSelect(Model, true, false, Model.GetSetting("DocumentFolder"))
@RenderImageSelect(Model, 640, true, false, Model.GetSetting("ImageFolder"))

<script>
    $(document).ready(function () {
        $(':checkbox').attr('class', 'w3-check');

        $("#datalist").sortable();
        $("#datalist").disableSelection();

        $('.editbutton').unbind("click");
        $('.editbutton').click(function () {
            var row = $(this).attr('row');
            dnnrocket_showdetail(row);
        });

        $('.editbuttonclose').unbind("click");
        $('.editbuttonclose').click(function () {
            var row = $(this).attr('row');
            dnnrocket_hidedetail(row);
        });

    });


    function dnnrocket_showdetail(row) {
        $('#detailDisplay' + row).show();
        $("#datalist").sortable("option", "disabled", true);
        $('#editbutton' + row).hide();
        $('#editbuttoncloseup' + row).show();
        $('#editbuttonclosedown' + row).show();
        $('#editbutton' + row).addClass('detailopen');
    }

    function dnnrocket_hidedetail(row) {
        $('#detailDisplay' + row).hide();

        $('#editbutton' + row).show();
        $('#editbuttoncloseup' + row).hide();
        $('#editbuttonclosedown' + row).hide();
        $('#editbutton' + row).removeClass('detailopen');

        var activatesort = true;
        $('.editbutton').each(function (index) {
            if ($(this).hasClass('detailopen')) {
                activatesort = false;
            }
        });
        if (activatesort) {
            $("#datalist").sortable("option", "disabled", false);
        }
    }

</script>


