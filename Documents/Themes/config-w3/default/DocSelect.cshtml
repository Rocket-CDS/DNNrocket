@inherits RocketMod.RocketModTokens<Simplisity.SimplisityRazor>
@using DNNrocketAPI;
@using Simplisity;

@AddMetaData("resourcepath", "/DesktopModules/DNNrocket/api/App_LocalResources/")

<div id="dnnrocket_deletedocumentlist">
    <input id="dnnrocket-documentlist" type="hidden" value="" />
</div>

<div id="rocketdocumentselect" class="w3-modal">
    <div class="w3-modal-content">

        <header class="w3-theme-d5 w3-center" style="height: 38px;">
            <span onclick="document.getElementById('rocketdocumentselect').style.display='none'" class="w3-button w3-display-topright">&times;</span>
            <h4>@ResourceKey("DNNrocket.documents")</h4>
        </header>
        <div class="" style="">
            <br />
            <div class="w3-container">

                <span class="w3-section">
                    <button class="w3-button w3-teal w3-padding-8 fileuploadaction" onclick="$('#documentfileupload').trigger('click')">@ResourceKey("DNNrocket.cmdUploadButton")</button>
                    <button class="w3-button w3-green w3-padding-8" onclick="dnnrocketdocs_useimages()">@ResourceKey("DNNrocket.cmdUseButton")</button>
                    <button class="w3-button w3-red w3-padding-8 simplisity_click" s-cmd="rocketdocs_delete" s-before="dnnrocketdocs_deleteimages" s-after="dnnrocketdocs_showthelist" s-return="#dnnrocket_imageselectwrapper" s-post="#dnnrocket_deleteimagelist"  s-fields="theme:config-w3,template:imagelist.cshtml,systemprovider:dnnrocket,interfacekey:imageupload">@ResourceKey("DNNrocket.cmdDeleteButton")</button>
                </span>

                <div class="w3-panel w3-white w3-rest" style="border-style:dotted">
                    <input id="documentfileupload" class="simplisity_fileupload" s-cmd="rocketdocs_upload" s-reload="false" s-after="dnnrocketdocs_showthelist"  s-return="#dnnrocket_imageselectwrapper" s-cmdurl="/desktopmodules/dnnrocket/api/api.ashx" s-fields="createseo:false,imageresize:800,theme:config-w3,template:documentlist.cshtml,systemprovider:dnnrocket,interfacekey:documentupload" type="file" name="files[]" multiple style="display:none;">
                    <p><i>@ResourceKey("DNNrocket.drophere")...</i></p>
                </div>

                <div id="reocketimageselectlist" class="w3-container">
                    <div class="">


                        @{
                            var lp = 1;
                            foreach (string i in Model.List)
                            {

                                <div class="w3-row">
                                    <div class="w3-col m2 dnnrocket-documentselector" dnnrocket-documentname="" dnnrocket-documenturl="@DNNrocketUtils.HomeRelDirectory()/docs/" selectorcount="@(lp)">

                                    </div>
                                    lp += 1;
                                </div>

                                lp += 1;
                            }

                        }
                    </div>

                </div>

            </div>
        </div>
    </div>
</div>

<script>


    $(document).ready(function () {

        $('.dnnrocket-documentselector').unbind("click");
        $('.dnnrocket-documentselector').click(function () {
            dnnrocketdocs_selectdocument(this);
        });

        // Used to display image list and assign the index, so we knwo what image to update.
        $('.dnnrocket-documentchange').unbind("click");
        $('.dnnrocket-documentchange').click(function () {
            simplisity_setCookieValue('dnnrocket-documentindex', $(this).parent().find("input:first").attr('id'));
            document.getElementById('rocketdocumentselect').style.display = 'block';
        });

        $('.dnnrocket-documentremove').unbind("click");
        $('.dnnrocket-documentremove').click(function () {
            $(this).parent().find("input:first").val('');
        });

    });


    function dnnrocketdocs_selectdocument(element) {

    @if (Model.HeaderData.GetXmlPropertyBool("genxml/hidden/documentselectsingle")) {
        @: dnnrocketdocs_clearselection();
    }

    if ($(element).hasClass('w3-theme')) {
        $(element).removeClass('w3-theme');
    }
    else {
        $(element).addClass('w3-theme');
    }

    @if (Model.HeaderData.GetXmlPropertyBool("genxml/hidden/imageselectautoreturn")) {
        @: dnnrocketdocs_usedocument();
    }
}

    function dnnrocketdocs_deletedocument() {
        var documentlist = '';
        $('.dnnrocket-documentselector').each(function (index) {
            if ($(this).hasClass('w3-theme')) {
                var documentname = simplisity_encode($(this).attr('dnnrocket-imagename'));
                documentlist = documentlist + documentname + ";";
                $(this).removeClass('w3-theme');
            }
        });
        $('#dnnrocket-documentlist').val(documentlist);
    }


    function dnnrocketdocs_usedocument() {
        $('.dnnrocket-documentselector').each(function (index) {
            if ($(this).hasClass('w3-theme')) {
                var idx = simplisity_getCookieValue('dnnrocket-documentindex');
                $('#' + idx).val($(this).attr('dnnrocket-documenturl'));
                $(this).removeClass('w3-theme');
            }
        });
        document.getElementById('rocketdocumentselect').style.display = 'none';
    }


    function dnnrocketdocs_clearselection() {
        $('.dnnrocket-documentselector').each(function (index) {
            if ($(this).hasClass('w3-theme')) {
                $(this).removeClass('w3-theme');
            }
        });
    }

    function dnnrocketdocs_showthelist() {
        document.getElementById('rocketdocumentselect').style.display = 'block';
    }

</script>