@inherits Rocket.Tools.RocketToolsTokens<Simplisity.SimplisityRazor>
@using DNNrocketAPI;
@using System
@using System.Linq
@using System.Xml
@using Simplisity;
@using DNNrocketAPI.Componants;
@using RazorEngine.Text;

@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/api/App_LocalResources/")
@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/Tools/App_LocalResources/")


<h1>@ResourceKey("RocketTools.rocketlang")</h1>
<p>@ResourceKey("RocketTools.rocketlang", "", "Help")</p>

<div class="w3-row w3-margin-bottom langaugeselection">
    <div class="w3-third w3-padding">
        <div class="w3-panel w3-theme-d2 w3-padding" style="height:52px;">
            <b class="w3-large">@ResourceKey("DNNrocket.system")</b>
        </div>
        <div class="hummingbird-treeview well h-scroll-large">
            <ul id="systemlistdata" class="hummingbird-base">

                @{
                    var systemDataList = new SystemDataList();
                    var list = systemDataList.GetSystemList();
                    foreach (var sk in list)
                    {
                        var systemData = new SystemData(sk.ItemID);
                        if (systemData.GetInterface("copylanguage") != null)
                        {
                            <li>
                                <label>
                                    <input id='sk.GUIDKey' class="systemcheckbox" systemid='@sk.ItemID' s-xpath="genxml/checkbox/systemid@(sk.ItemID)" s-update="save" type="checkbox">
                                    @sk.GetXmlProperty("genxml/textbox/systemname")
                                </label>
                            </li>
                        }
                    }
                }
            </ul>
        </div>
    </div>

        <div class="w3-third w3-padding">
            <div class="w3-panel w3-theme-d2 w3-padding" style="height:52px;">
                <b class="w3-large">@ResourceKey("RocketTools.copylanguage")</b>
            </div>
            @DropDownLanguageList(new SimplisityInfo(), "genxml/copylanguage", "class='w3-input w3-border' ")
        </div>

        <div class="w3-third w3-padding" style="height:200px;">
            <div class="w3-panel w3-theme-d2 w3-padding" style="height:52px;">
                <b class="w3-large">@ResourceKey("RocketTools.destinationlanguage")</b>
            </div>
            @DropDownLanguageList(new SimplisityInfo(), "genxml/destinationlanguage", "class='w3-input w3-border' ")
            @CheckBox(new SimplisityInfo(),"genxml/checkbox/backup",ResourceKey("DNNrocket.backup").ToString()," class='w3-check w3-margin-top'", true)
            <div class="w3-button w3-right w3-margin-top w3-green w3-padding copybutton simplisity_confirmclick" style="display:none;" s-confirm="@ResourceKey("RocketTools.copylanguage", "", "Confirm")" s-cmd="rocketlang_copy" s-fields='' s-post=".langaugeselection"><i class="fas fa-save"></i>&nbsp;@ResourceKey("RocketTools.copylanguage")</div>

        </div>

    </div>


<div class="w3-row w3-padding">
    <div class="w3-panel w3-theme-d2 w3-padding" style="height:52px;">
        <b class="w3-large">@ResourceKey("DNNrocket.backup")</b>
        <div class="w3-button w3-right w3-padding simplisity_confirmclick" title="@ResourceKey("DNNrocket.delete")" s-confirm="@ResourceKey("RocketTools.deletebackupall", "", "Confirm")" s-cmd="rocketlang_deletebackupall" s-fields=''><i class="fas fa-trash-alt"></i></div>
    </div>
    <div class="w3-row historydatasection">

        <table class="w3-table w3-bordered">
            <tr>
                <th style="width:200px;">@ResourceKey("DNNrocket.date")</th>
                <th>@ResourceKey("DNNrocket.systemkey")</th>
                <th></th>
                <th></th>
            </tr>

            @{
                var BackUpDataList = new BackUpDataList("rocketlang");
                foreach (var moduleFolder in BackUpDataList.SystemKeyFolderList)
                {
                    foreach (var BackUpData in BackUpDataList.GetBackUpList(moduleFolder))
                    {
                        <tr>
                            <td>
                                @BackUpData.BackUpDate.ToString("yyyy-MM-dd HH:mm:ss")
                            </td>
                            <td>@moduleFolder</td>
                            <td style="width:74px;">
                                <div class="w3-button w3-padding simplisity_confirmclick" title="@ResourceKey("DNNrocket.restore")" s-confirm="@ResourceKey("RocketTools.restorebackup", "", "Confirm")" s-cmd="rocketlang_restorebackup" s-fields='{"filemappath":"@GeneralUtils.EnCode(BackUpData.FileMapPath)"}'><i class="fas fa-recycle"></i></div>
                            </td>
                            <td style="width:74px;">
                                <div class="w3-button w3-padding simplisity_confirmclick" title="@ResourceKey("DNNrocket.delete")" s-confirm="@ResourceKey("RocketTools.deletebackup", "", "Confirm")" s-cmd="rocketlang_deletebackup" s-fields='{"filemappath":"@GeneralUtils.EnCode(BackUpData.FileMapPath)"}'><i class="fas fa-trash-alt"></i></div>
                            </td>
                        </tr>
                    }
                }
            }
        </table>

    </div>
</div>


<script>

    $(document).ready(function () {

        simplisity_setParamField('pageref', CreateGuid());

        $(".systemcheckbox").unbind('click');
        $(".systemcheckbox").click(function () {
            if (jQuery('.systemcheckbox:checked').length) {
                $('.copybutton').show();
            } else {
                $('.copybutton').hide();
            }
        });        

    });

    function CreateGuid() {
        function _p8(s) {
            var p = (Math.random().toString(16) + "000000000").substr(2, 8);
            return s ? "-" + p.substr(0, 4) + "-" + p.substr(4, 4) : p;
        }
        return _p8() + _p8(true) + _p8(true) + _p8();
    }


</script>

