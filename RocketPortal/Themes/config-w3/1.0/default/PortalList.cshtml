@inherits RocketPortal.Components.RocketPortalTokens<Simplisity.SimplisityRazor>
@using Simplisity;
@using DNNrocketAPI.Components;
@using RocketPortal.Components;
@using System.IO;

@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/api/App_LocalResources/")
@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/RocketPortal/App_LocalResources/")

@{
    var portalList = (PortalLimpetList)Model.List.First();
    var websiteBuild = (WebsiteBuild)Model.GetDataObject("websitebuild");
}

<div id="portallist" class="">

    <div class="w3-bar searchdata">

        @HiddenField(new SimplisityInfo(), "genxml/hidden/page", " class='simplisity_sessionfield' s-update='ignore'", "1")

        <button type="button" class="w3-button w3-theme-action" onclick="$('#portallist').hide();$('#portaldetail').show();">@ButtonText(ButtonTypes.add)</button>
        <button class="w3-button simplisity_click" title="Clear All Cache" s-cmd="dashboard_clearallcache" s-post="" s-reload="true">@ButtonIcon(ButtonTypes.refresh)</button>

        <div class="w3-right w3-hide-small w3-margin-left" style="width: 100px">
            @DropDownList(new SimplisityInfo(), "genxml/hidden/pagesize", "8,16,32,64,128", "8,16,32,64,128", "class='w3-input w3-border w3-light-grey simplisity_sessionfield simplisity_change ' s-sessionfield='#searchtext,#pagesize,#orderbyref,#page' s-cmd='portal_list' s-post='.searchdata' s-fields='{\"track\":\"true\"}'  title='" + @ResourceKey("DNNrocket.pagesize") + "'", "32")
        </div>

        <div class="w3-right " style=''>
            <div class="w3-bar">
                <span class="w3-bar-item w3-button clearsearch " style="display:none;" s-fields=''>@ButtonIcon(ButtonTypes.cancel)</span>
                @TextBox(new SimplisityInfo(), "genxml/textbox/searchtext", " style='height:40px;' class='w3-bar-item w3-input w3-border w3-light-grey simplisity_sessionfield actionentrykey' autocomplete='off' ")
                <span class="w3-bar-item w3-button w3-theme langchangesave simplisity_click dosearch" s-sessionfield='#searchtext,#pagesize,#orderbyref,#page' s-cmd="portal_list" s-post=".searchdata" s-fields='{"track":"true"}'>@ButtonText(ButtonTypes.search)</span>
            </div>
        </div>
    </div>

    <div id="datalist" class="w3-container w3-margin-top">

        <table class="w3-table w3-bordered w3-hoverable">
            <thead>
                <tr>
                    <th>@ResourceKey("RP.name")</th>
                    <th>@ResourceKey("RP.serviceurl")</th>
                </tr>
            </thead>
            @foreach (PortalLimpet portalData in portalList.GetPortalList())
            {
                if (portalData.PortalId > 0)
                {
                    <tr class="simplisity_click" s-cmd="portal_detail" s-fields='{"portalid":"@portalData.PortalId","track":"false"}' style="cursor:pointer;">
                        <td><b>@portalData.Name</b></td>
                        <td>
                            @portalData.EngineUrl
                        </td>
                    </tr>
                }
            }
        </table>

    </div>
</div>

<div id="portaldetail" class="" style="display:none;">
    <div class="w3-row w3-padding">
        <div class="w3-button" onclick="$('#portaldetail').hide();$('#portallist').show();">@ButtonIcon(ButtonTypes.back)</div>
    </div>
    <div class="w3-container w3-margin-top">
        @{
            var lp = 0;
        }
        @foreach (var buildConfig in websiteBuild.ConfigList)
        {
        <div class="w3-quarter w3-padding">
            <div class="w3-card-4">

                <header class="w3-container w3-light-grey">
                    <h3>@buildConfig.GetXmlProperty("genxml/name")</h3>
                </header>

                <div class="w3-container w3-margin-top w3-margin-bottom">
                    <div>@buildConfig.GetXmlProperty("genxml/desc1")&nbsp;</div>
                    <div>@buildConfig.GetXmlProperty("genxml/desc2")&nbsp;</div>
                    <div>@buildConfig.GetXmlProperty("genxml/desc3")&nbsp;</div>
                    <div>@buildConfig.GetXmlProperty("genxml/desc4")&nbsp;</div>
                </div>

                <div class="w3-button w3-block w3-dark-grey simplisity_click" s-cmd="portal_create" s-reload="false" s-fields='{"buildconfigfile":"@buildConfig.GetXmlProperty("genxml/filename")"}'>@ButtonText(ButtonTypes.create)</div>

            </div>
        </div>
            lp += 1;
        }
    </div>
</div>

<script>
    $(document).ready(function () {
        $('.displayportallist').show();

        // turn off the reload flag
        simplisity_setParamField("reload", false)

        $('.clearsearch ').unbind("click");
        $('.clearsearch ').click(function () {
            $('#searchtext').val('');
            $('.clearsearch').hide();
            $('.dosearch').trigger('click');
            return false; // prevent the button click from happening
        });

        if ($('#searchtext').val() !== '') {
            $('.clearsearch').show();
        }

        $('.actionentrykey').unbind('keypress');
        $('.actionentrykey').on('keypress', function (e) {
            if (e.keyCode == 13) {
                $('.dosearch').trigger('click');
                return false; // prevent the button click from happening
            }
        });

        $('.actionentrykey').focus();

        // move cursor to end of line
        var tmpStr = $('.actionentrykey').val();
        $('.actionentrykey').val('');
        $('.actionentrykey').val(tmpStr);

        $('.w3-radio').unbind("click");
        $('.w3-radio').click(function () {
            $('#createbutton').show();
        });

    });

</script>


