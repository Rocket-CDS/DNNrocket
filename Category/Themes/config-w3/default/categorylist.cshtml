@inherits DNNrocketAPI.render.DNNrocketTokens<Simplisity.SimplisityRazor>
@using Simplisity;
@using DNNrocket.Category;

@AddMetaData("resourcepath", "/DesktopModules/DNNrocket/api/App_LocalResources/")
@AddMetaData("resourcepath", "/DesktopModules/DNNrocket/SystemData/App_LocalResources/")
@AddMetaData("resourcepath", "/DesktopModules/DNNrocket/Category/App_LocalResources/")

<style type="text/css">

    /**
    * Nestable
    */

    .dd {
        position: relative;
        display: block;
        margin: 0;
        padding: 0;
        list-style: none;
        font-size: 13px;
        line-height: 40px;
    }

    .dd-list {
        display: block;
        position: relative;
        margin: 0;
        padding: 0;
        list-style: none;
    }

        .dd-list .dd-list {
            padding-left: 30px;
        }

    .dd-collapsed .dd-list {
        display: none;
    }

    .dd-item,
    .dd-empty,
    .dd-placeholder {
        display: block;
        position: relative;
        margin: 0;
        padding: 0;
        min-height: 40px;
        font-size: 13px;
        line-height: 40px;
    }

    .dd-handle {
        display: block;
        height: 50px;
        margin: 5px 0;
        padding: 5px 10px;
        color: #333;
        text-decoration: none;
        font-weight: bold;
        border: 1px solid #ccc;
        background: #fafafa;
        background: -webkit-linear-gradient(top, #fafafas 0%, #eee 100%);
        background: -moz-linear-gradient(top, #fafafas 0%, #eee 100%);
        background: linear-gradient(top, #fafafas 0%, #eee 100%);
        -webkit-border-radius: 3px;
        border-radius: 3px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
    }

        .dd-handle:hover {
            color: #2ea8e5;
            background: #fff;
        }

    .dd-item > button {
        display: block;
        position: relative;
        cursor: pointer;
        float: left;
        width: 25px;
        height: 40px;
        margin: 5px 0;
        padding: 0;
        text-indent: 100%;
        white-space: nowrap;
        overflow: hidden;
        border: 0;
        background: transparent;
        font-size: 12px;
        line-height: 1;
        text-align: center;
        font-weight: bold;
    }

        .dd-item > button:before {
            content: '\f067';
            display: block;
            position: absolute;
            width: 100%;
            text-align: center;
            text-indent: 0;
            font-family: "FontAwesome";
            font-weight: 600;
        }

        .dd-item > button[data-action="collapse"]:before { content: '\f068'; font-family: "FontAwesome"; font-weight: 600; }

    .dd-placeholder,
    .dd-empty {
        margin: 5px 0;
        padding: 0;
        min-height: 50px;
        background: #f2fbff;
        border: 1px dashed #b6bcbf;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
    }

    .dd-empty {
        border: 1px dashed #bbb;
        min-height: 100px;
        background-color: #e5e5e5;
        background-image: -webkit-linear-gradient(45deg, #fff 25%, transparent 25%, transparent 75%, #fff 75%, #fff), -webkit-linear-gradient(45deg, #fff 25%, transparent 25%, transparent 75%, #fff 75%, #fff);
        background-image: -moz-linear-gradient(45deg, #fff 25%, transparent 25%, transparent 75%, #fff 75%, #fff), -moz-linear-gradient(45deg, #fff 25%, transparent 25%, transparent 75%, #fff 75%, #fff);
        background-image: linear-gradient(45deg, #fff 25%, transparent 25%, transparent 75%, #fff 75%, #fff), linear-gradient(45deg, #fff 25%, transparent 25%, transparent 75%, #fff 75%, #fff);
        background-size: 60px 60px;
        background-position: 0 0, 30px 30px;
    }

    .dd-dragel {
        position: absolute;
        pointer-events: none;
        z-index: 9999;
    }

        .dd-dragel > .dd-item .dd-handle {
            margin-top: 0;
        }

        .dd-dragel .dd-handle {
            -webkit-box-shadow: 2px 4px 6px 0 rgba(0,0,0,.1);
            box-shadow: 2px 4px 6px 0 rgba(0,0,0,.1);
        }

    /**
    * Nestable Extras
    */

    .nestable-lists {
        display: block;
        clear: both;
        padding: 30px 0;
        width: 100%;
        border: 0;
        border-top: 2px solid #ddd;
        border-bottom: 2px solid #ddd;
    }

    #nestable-menu {
        padding: 0;
        margin: 20px 0;
    }

    .dd-hover > .dd-handle {
        background: #2ea8e5 !important;
    }

    /**
    * Nestable Draggable Handles
    */

    .dd3-content {
        display: block;
        height: 50px;
        margin: 5px 20px;
        padding: 5px 10px 5px 40px;
        color: #333;
        text-decoration: none;
        font-weight: bold;
        border: 1px solid #ccc;
        background: #fafafa;
        background: -webkit-linear-gradient(top, #fafafas 0%, #eee 100%);
        background: -moz-linear-gradient(top, #fafafas 0%, #eee 100%);
        background: linear-gradient(top, #fafafas 0%, #eee 100%);
        -webkit-border-radius: 3px;
        border-radius: 3px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
    }

        .dd3-content:hover {
            color: #2ea8e5;
            background: #fff;
        }

    .dd-dragel > .dd3-item > .dd3-content {
        margin: 0;
    }

    .dd3-item > button {
        margin-left: -20px;
    }

    .dd3-handle {
        position: absolute;
        margin: 0;
        left: 0;
        top: 0;
        cursor: pointer;
        width: 40px;
        text-indent: 100%;
        white-space: nowrap;
        overflow: hidden;
        border: 1px solid #aaa;
        background: #ddd;
        background: -webkit-linear-gradient(top, #ddd 0%, #bbb 100%);
        background: -moz-linear-gradient(top, #ddd 0%, #bbb 100%);
        background: linear-gradient(top, #ddd 0%, #bbb 100%);
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
    }

        .dd3-handle:before {
            content: '≡';
            display: block;
            position: absolute;
            left: 0;
            top: 3px;
            width: 100%;
            text-align: center;
            text-indent: 0;
            color: #fff;
            font-size: 20px;
            font-weight: normal;
        }

        .dd3-handle:hover {
            background: #ddd;
        }

    /**
    * Socialite
    */

    .socialite {
        display: block;
        float: left;
        height: 55px;
    }
</style>



<div class="w3-container">

    <span class="w3-section simplisity_buttons" id="buttonsrequired" style="display:none;">
        <i style="display:none;" class="fas fa-refresh simplisity_langchange simplisity_click" s-cmd="category_getlist" s-fields="theme:config-w3,template:CategoryList.cshtml,interfacekey:category"></i>
        <button class="w3-button w3-green w3-padding-8 simplisity_click" s-cmd="category_savelist" s-post="#datareturn" s-fields="theme:config-w3,template:CategoryList.cshtml,interfacekey:category">@ResourceKey("DNNrocket.cmdSaveButton")</button>
    </span>

    <div class="w3-row w3-margin">
        <button class="w3-button w3-green w3-padding-8 simplisity_click" s-cmd="category_add" s-fields="theme:config-w3,template:CategoryDetail.cshtml,interfacekey:category">@ResourceKey("DNNrocket.cmdAddButton")</button>
    </div>

    <header class="w3-container w3-theme">
        <h5>
            @ResourceKey("category.categories")
                <a href="javascript:void(0)" class="w3-padding-8 w3-margin category_expandall" title="@ResourceKey("category.expandall")"><i class="fas fa-plus-circle" aria-hidden="true"></i></a>
                <a href="javascript:void(0)" class="w3-padding-8 category_colapseall" title="@ResourceKey("category.colapseall")"><i class="fas fa-minus-circle" aria-hidden="true"></i></a>
            </h5>
    </header>

    <div class="w3-row">

        <div class="dd w3-margin" id="nestable3" style="display:none;">
            <ol class="dd-list">

                @foreach (Category cat in Model.List)
                {
                    if (cat.IsRoot)
                    {
                        <li class="dd-item dd3-item" data-id="@cat.Info.ItemID" data-parentid="@cat.Info.ParentItemId">
                            @Showli(cat)
                            @if (cat.HasChildren)
                            {
                                @ShowTree(cat.Children);
                            }
                        </li>
                    }
                }
            </ol>
        </div>

    </div>
</div>

<div id="datareturn">
    <input id="jsondata" type="hidden" value="" />
</div>

<script src="/DesktopModules/DNNrocket/Category/Themes/config-w3/js/jquery.nestable.js"></script>

<script>

    $(document).ready(function () {

        var updateOutput = function (e) {
            var list = e.length ? e : $(e.target),
                output = list.data('output');
            if (typeof output !== 'undefined') {
                if (window.JSON) {
                    output.val(window.JSON.stringify(list.nestable('serialize')));//, null, 2));
                } else {
                    output.val('');
                }
            }
        };

        $('#nestable3').nestable({
            group: 1,
            maxDepth: 20
        })
            .on('change', updateOutput);

        updateOutput($('#nestable3').data('output', $('#jsondata')));

        var nestable_category = simplisity_getCookieValue('nestable_category');
        if (nestable_category === 'collapseAll') {
            $('#nestable3').nestable('collapseAll');
        }

        $('#nestable3').show();

        $('.category_expandall').unbind("click");
        $('.category_expandall').click(function () {
            $('#nestable3').nestable('expandAll');
            simplisity_setCookieValue('nestable_category', 'expandAll');
        });

        $('.category_colapseall').unbind("click");
        $('.category_colapseall').click(function () {
            $('#nestable3').nestable('collapseAll');
            simplisity_setCookieValue('nestable_category', 'collapseAll');
        });


    });

</script>

@helper ShowTree(IEnumerable<Category>
    cats)
    {
    <ol class="dd-list">
        @foreach (Category cat in cats)
        {
            <li class="dd-item dd3-item" data-id="@cat.Info.ItemID" data-parentid="@cat.Info.ParentItemId">
                @Showli(cat)
                @if (cat.HasChildren)
                {
                    @ShowTree(cat.Children);
                }
            </li>
        }
    </ol>
    }

    @helper Showli(Category cat)
        {
                    <div class="dd-handle dd3-handle w3-theme"></div><div class="dd3-content w3-theme-l4">
    @cat.Ref:     @cat.Name
    <a class="simplisity_click w3-right" s-track="true" s-cmd="category_getdetail" s-fields="selecteditemid:@cat.Info.ItemID ,theme:config-w3,template:CategoryDetail.cshtml,interfacekey:category" s-return="#simplisity_startpanel" href="javascript:void(0)">@ResourceKey("DNNrocket.cmdEditIcon")</a>
    @{
        var eyestate = ResourceKey("category.hiddenicon_false").ToString();
        if (cat.IsHidden)
        {
            eyestate = ResourceKey("category.hiddenicon_true").ToString();
        }
        var diablestate = ResourceKey("category.toggleicon_on").ToString();
        if (cat.IsDisabled)
        {
            diablestate = ResourceKey("category.toggleicon_off").ToString();
        }
    }
    <a class="simplisity_click w3-right w3-margin-right eyestatus@(cat.Info.ItemID)" s-cmd="category_visible" s-return=".eyestatus@(cat.Info.ItemID)" s-fields="selecteditemid:@cat.Info.ItemID,interfacekey:category" href="javascript:void(0)">@HtmlOf(eyestate)</a>
    <a class="simplisity_click w3-right w3-margin-right disablestatus@(cat.Info.ItemID)" s-cmd="category_disable" s-return=".disablestatus@(cat.Info.ItemID)" s-fields="selecteditemid:@cat.Info.ItemID,interfacekey:category" href="javascript:void(0)">@HtmlOf(diablestate)</a>
</div>
        }
