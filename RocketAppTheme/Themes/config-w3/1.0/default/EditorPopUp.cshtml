@inherits DNNrocketAPI.render.DNNrocketTokens<Simplisity.SimplisityRazor>
@using DNNrocketAPI;
@using Simplisity;
@using Rocket.AppThemes.Components;
@using System.IO;
@using DNNrocketAPI.Components;
@using RocketPortal.Components;

@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/images/App_LocalResources/")
@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/api/App_LocalResources/")
@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/SystemData/App_LocalResources/")
@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/AppThemes/App_LocalResources/")

@{
    var appTheme = (AppThemeLimpet)Model.GetDataObject("apptheme");
    var sessionParams = Model.SessionParamsData;
    var appThemeSystem = (AppThemeDNNrocketLimpet)Model.GetDataObject("appthemesystem");
    var portalData = (PortalLimpet)Model.GetDataObject("portaldata");

    var disableDelete = true;
    var backcmd = "rocketapptheme_getdetail";
}

<div class="w3-row w3-padding">
    <div class="w3-margin-bottom w3-padding">

        <span class="w3-button w3-black  simplisity_click" s-cmd="@(backcmd)" s-return="#editmodalcontainer" s-fields='{"moduleref":"@(sessionParams.ModuleRef)","filename":"@sessionParams.Get("filename")","selectedproject":"@appTheme.ProjectName","appthemesystemkey":"@appTheme.SystemKey","appthemefolder":"@appTheme.AppThemeFolder","appversionfolder":"@appTheme.AppVersionFolder"}'>@ButtonText(ButtonTypes.back)</span>

        <div class="w3-button w3-theme-action savebutton simplisity_click" s-before="saveeditordata" s-return="#editmodalcontainer" s-cmd="@(Model.GetSetting("interfacekey"))_saveeditor" s-post="#editorsave" s-fields='{"moduleref":"@(sessionParams.ModuleRef)","filename":"@Model.GetSetting("filename")","selectedproject":"@appTheme.ProjectName","appthemesystemkey":"@appTheme.SystemKey","appthemefolder":"@appTheme.AppThemeFolder","appversionfolder":"@appTheme.AppVersionFolder"}'>@ButtonText(ButtonTypes.save)</div>
        @if (appTheme.IsModuleLevel(Model.GetSetting("filename"), sessionParams.ModuleRef))
        {
            disableDelete = false;
            <span class=" w3-bar-item w3-margin-left w3-text-pale-blue"><img src="/images/level_module.svg" /></span>
        }
        else
        {
            if (appTheme.IsPortalLevel(Model.GetSetting("filename")))
            {
                disableDelete = false;
                if (sessionParams.ModuleRef != "")
                {
                    disableDelete = true;
                }
                <span class=" w3-bar-item w3-margin-left w3-text-indigo"><img src="/images/level_portal.svg" /></span>
            }
        }
        @if (!disableDelete)
        {
            <div class=" w3-bar-item w3-button w3-right w3-red w3-padding-8 simplisity_confirmclick" s-confirm="@ResourceKey("DNNrocket.delete") ?"  s-return="#editmodalcontainer" s-cmd="@(Model.GetSetting("interfacekey"))_deletefile" s-fields='{"filename":"@Model.GetSetting("filename")","selectedproject":"@appTheme.ProjectName","appthemesystemkey":"@appTheme.SystemKey","appthemefolder":"@appTheme.AppThemeFolder","appversionfolder":"@appTheme.AppVersionFolder","moduleref":"@sessionParams.Get("moduleref")"}'>@ButtonText(ButtonTypes.delete)</div>
        }
        @if (sessionParams.ModuleRef != "")
        {
            <span class="w3-right w3-large w3-margin-right">@(sessionParams.ModuleRef)</span>
        }
        else
        {
            <span class="w3-right w3-large w3-margin-right">Portal: @(appTheme.PortalId)</span>
        }
    </div>
    <div class="w3-row ">
        <b id="editorfilename" class="" style="">@Model.GetSetting("filename")</b>
    </div>

    <div id="editorsave" style="">
        @HiddenField(new SimplisityInfo(), "genxml/hidden/selectedsystemkey", "", appTheme.SystemKey)
        <input id="editorcodesave" type="hidden" value="" />
    </div>

    <input id="editorsavereturn" type="hidden" value="" />

    <div id="editorwrapper" class="w3-row " style="height:800px;">

        <textarea id="razoreditor" style="width:100%;height:700px;" class="w3-large w3-black w3-text-yellow">@appTheme.GetTemplate(Model.GetSetting("filename"), sessionParams.ModuleRef)</textarea>

    </div>

</div>

<script>

        $(document).ready(function () {

        });

    function saveeditordata() {
        $('#editorcodesave').val(simplisity_encode($('#razoreditor').val()));
        $('#saveicon').show();
        $("#saveicon").fadeOut();
    }

</script>