@inherits RocketTools.RocketToolsTokens<Simplisity.SimplisityRazor>
@using System
@using System.Xml
@using Simplisity;
@using RazorEngine.Text;
@using System.Xml;

@AddProcessData("resourcepath", "/DesktopModules/RocketTools/App_LocalResources/")

@{
    var info = (SimplisityInfo)Model.List.First();
    var selectedModuleId = " where ";
    foreach (SimplisityInfo m in info.GetList("clonemoduleactive"))
    {
        selectedModuleId += " moduleid = " + m.GetXmlProperty("genxml/moduleid") + "  or ";
    }
    selectedModuleId = selectedModuleId.Substring(0, selectedModuleId.Length - 3);

    var objCtrl = new DNNrocketAPI.DNNrocketController();
    var sqlXML = objCtrl.GetSqlxml("SELECT [TabID] FROM {databaseOwner}[{objectQualifier}TabModules] " + selectedModuleId + " FOR XML PATH, ROOT('genxml')");
    var sXml = new SimplisityRecord();
    sXml.XMLData = sqlXML;
    var tabIdList = new List<string>();
    var nodList = sXml.XMLDoc.SelectNodes("genxml/row");
    if (nodList != null)
    {
        foreach (XmlNode r in nodList)
        {
            tabIdList.Add(r.SelectSingleNode("TabID").InnerText);
        }
    }
}

<div class="w3-row">
    <div class="w3-button w3-left w3-margin-left" id="checkAll">
        <span class="material-icons">
            playlist_add_check
        </span>
    </div>
    <div class="w3-button w3-left" id="uncheckAll">
        <span class="material-icons">
            playlist_remove
        </span>
    </div>
</div>
<div id="treeview3_container" class="hummingbird-treeview well h-scroll-large">
    @GetTabList(RocketTools.RocketToolsUtils.GetPortalId(), new List<int>(), "checkboxlist", "", "", true)
</div>

<script>

    $(document).ready(function () {

        $('.rocketclonesbutton').show();

        $("#checkAll").click(function () {
            $("#treeview3").hummingbird("checkAll");
        });
        $("#uncheckAll").click(function () {
            $("#treeview3").hummingbird("uncheckAll");
        });

    @foreach (var t in tabIdList)
    {
        <text>
        $('#tabid-checkboxlist-@(t)').attr('checked', 'true');
        </text>
    }
        $('#tabid-checkboxlist-@(info.GetXmlProperty("genxml/fromtabid"))').attr("disabled", true);




    });

</script>

